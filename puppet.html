<!-- <!DOCTYPE html> -->
<html lang="en">
<head>

  <!-- Basic Page Needs –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <meta charset="utf-8">
    <title>CPA Puppet Archive</title>
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Mobile Specific Metas –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- FONT –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <link href="https://fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">

    <!-- Bootstrap –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.3.0/mustache.js"></script>
    
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <!-- Custom CSS –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <link rel="stylesheet" href="css/styles.css">

    <!-- Favicon –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <link rel="icon" type="image/png" href="img/favicon.png">

    <script id="images-template" type="x-tmpl-mustache">
        {{#images}}
            <a href="#" data-toggle="modal" data-target="#imageCarousel"><img src={{.}} class="media-object col-md-4"></a>
        {{/images}}
    </script>

    <script id="page-title-template" type="x-tmpl-mustache">
        {{name}}
    </script>

    <script id="info-template" type="x-tmpl-mustache">
        <div class="row">
            <span class="col-md-12">{{description}}</span>
        </div>
        {{#info}}
            <div class="row">
                <span class="col-md-4">{{key}}</span>
                <span class="col-md-8">{{value}}</span>
            </div>
        {{/info}}
    </script>

    <script>
        function urlParam(name) {
            var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
            return results?results[1] : 0;
        };

        var imagesTabTemplate = $('#images-template').html();
        Mustache.parse(imagesTabTemplate);                          // optional, speeds up future uses
        var infoTabTemplate = $('#info-template').html();
        Mustache.parse(infoTabTemplate);                            // optional, speeds up future uses
        var pageTitleTemplate = $('#page-title-template').html();
        Mustache.parse(pageTitleTemplate);                          // optional, speeds up future uses

        function renderHeader(){
            // $("#header-wrapper").load("header.html");
            var searchClass = urlParam("class");
            searchClass = searchClass?searchClass:"ASIAN";
            var element = $(document.getElementById(searchClass));
            console.log("el:", element);
            element.addClass("selected");
        }

        function renderImagesTab(puppet){
            var imagesTabRendered = Mustache.render(imagesTabTemplate, puppet);
            $('#images').html(imagesTabRendered);
        };

        function renderInfoTab(puppet){
            var infoTabRendered = Mustache.render(infoTabTemplate, puppet);
            $('#info').html(infoTabRendered);
        };

        function renderPageTitle(puppet){
            var pageTitleRendered = Mustache.render(pageTitleTemplate, puppet);
            $('#page-title').html(pageTitleRendered);
            $('.modal-title').html(pageTitleRendered);
        };

        function renderUnityElement(){
          var w = $('#unity-element-wrapper').offsetWidth;
          var h = $('#unity-element-wrapper').offsetHeight;
          document.getElementById('canvas').setAttribute("width", w - 30);
          document.getElementById('canvas').setAttribute("height", h - 30);
          console.log("DONE!!!!!!!!!!!!");
        }

        function updateAnchorHref(prevId, nextId){
          var searchClass = urlParam("class");
          var puppetId = urlParam("puppetId");
          var prevAnchor = $('#prev-anchor');
          var nextAnchor = $('#next-anchor');
          if (prevId !== undefined) {
            prevAnchor.prop("href", "/puppet.html?puppetId="+prevId+"&class="+searchClass);
          } else {
            prevAnchor.hide();
          }
          if (nextId !== undefined) {
            nextAnchor.prop("href", "/puppet.html?puppetId="+nextId+"&class="+searchClass);
          } else {
            nextAnchor.hide();
          }
        }

        function render(){
            var searchClass = urlParam("class");
            var puppetId = urlParam("puppetId");
            $.get('data.json', function(puppets) {
              puppets = $.map(puppets, (el, index) => {
                el.index = index;
                return el;
              });
              searchClass = searchClass?searchClass:"ASIAN";
              puppets = puppets.filter((el)=>{
                caseInsensitiveCollection = el.collection.toUpperCase();
                searchClass = searchClass.toUpperCase();
                return caseInsensitiveCollection.indexOf(searchClass) >= 0;
              });
              console.log("Index:", puppetId);
              var puppet = puppets.find((puppet)=> (puppet.index == puppetId));
              renderImagesTab(puppet);
              renderInfoTab(puppet);
              renderPageTitle(puppet);
              renderHeader();
              console.log("[TANMAY] puppetsFiltered: ", puppets);
              var prevId = undefined, nextId = undefined;
              for (i=0; i<puppets.length; i++) {
                if (puppets[i+1] && puppets[i+1].index == puppetId){
                  prevId = puppets[i].index;
                }
                if (puppets[i-1] && puppets[i-1].index == puppetId){
                  nextId = puppets[i].index;
                }
              }
              console.log("[TANMAY] prevId: ", prevId, "nextId", nextId);
              updateAnchorHref(prevId, nextId);
                // renderUnityElement();
            });
        };

    </script>

</head>
<body onload="render()">
  <!-- HEADER –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <div id="header-wrapper" class="container-fluid">
    <div class="row">
      <div class="col-md-12" id ="header">
          <span id="header-title" class="col-md-4" >Center For Puppetry Arts</span>
          
          <span id="header-explore" class="col-md-2">Explore other collections</span>
          <a class="header-location col-md-1" id="AFRICAN" href="/index.html?srch-class=AFRICAN">African</a>
          <a class="header-location col-md-1" id="AMERICAS" href="/index.html?srch-class=AMERICAS">Americas</a>
          <a class="header-location col-md-1" id="ASIAN" href="/index.html?srch-class=ASIAN">Asian</a>
          <a class="header-location col-md-1" id="EUROPEAN" href="/index.html?srch-class=EUROPEAN">European</a>
          <a class="header-location col-md-2" id="MIDEAST" href="/index.html?srch-class=MIDEAST">Middle Eastern</a>
      </div>
    </div>
  </div>

  <a id="prev-anchor" href="#"><span class="glyphicon glyphicon-triangle-left" id="left-nav-icon"></span></a>
  <div class="container">
    <!-- Body –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <div class="row" id ="main-body">
      <div class="col-md-8" id="unity-element-wrapper">
        <!-- <span>UNITY is loading... </span> -->
        <canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()" width="750" height="500"></canvas>
      </div>
      <script type="text/javascript">
        var callback = function (a,b,c){
          console.log("Unity callback called: ", a,b,c);
        }

        var Module = {
          TOTAL_MEMORY: 268435456,
          errorhandler: callback,   // arguments: err, url, line. This function must return 'true' if the error is handled, otherwise 'false'
          compatibilitycheck: null,
          backgroundColor: "#80858B",
          splashStyle: "Dark",
          dataUrl: "unity/Web_MonkeyKing.data",
          codeUrl: "unity/Web_MonkeyKing.js",
          asmUrl: "unity/Web_MonkeyKing.asm.js",
          memUrl: "unity/Web_MonkeyKing.mem"
        };
      </script>
      <div class="col-md-4" id="tabs">

        <h3 id ="page-title"></h3>

        <ul class="nav nav-tabs">
          <li class="active"><a data-toggle="tab" href="#info"><span class="glyphicon glyphicon-list-alt"></span></a></li>
          <li><a data-toggle="tab" href="#images"><span class="icon-images"></span></a></li>
          <li><a data-toggle="tab" href="#videos"><span class="icon-film disabled"></span></a></li>
          <li><a data-toggle="tab" href="#download"><span class="icon-download"></span></a></li>
        </ul>

        <div class="tab-content">
          <div id="info" class="tab-pane fade in active"></div>
          <div id="images" class="tab-pane fade"></div>
          <div id="videos" class="tab-pane fade">No videos available for the puppet</div>
          <div id="download" class="tab-pane fade">No downloads available for the puppet</div>
        </div>
      </div>
    </div>
  </div>
  <a id="next-anchor" href="#"><span class="glyphicon glyphicon-triangle-right" id="right-nav-icon"></span></a>
  
  <div id="imageCarousel" class="modal fade" role="dialog">
      <div class="modal-dialog">
    
        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Title comes here again</h4>
          </div>
          <div class="modal-body">
              <div id="myCarousel" class="carousel slide" data-ride="carousel">
                  <!-- Wrapper for slides -->
                  <div class="carousel-inner">
                    <div class="item active">
                      <img src="img/img_avatar1.png" style="width:100%;">
                    </div>
              
                    <div class="item">
                      <img src="img/img_avatar1.png" style="width:100%;">
                    </div>
                  
                    <div class="item">
                      <img src="img/img_avatar1.png" style="width:100%;">
                    </div>
                  </div>
              
                  <!-- Left and right controls -->
                  <a class="left carousel-control" href="#myCarousel" data-slide="prev">
                    <span class="glyphicon glyphicon-chevron-left"></span>
                    <span class="sr-only">Previous</span>
                  </a>
                  <a class="right carousel-control" href="#myCarousel" data-slide="next">
                    <span class="glyphicon glyphicon-chevron-right"></span>
                    <span class="sr-only">Next</span>
                  </a>
                </div>
          </div>
        </div>
    
      </div>
    </div>
    <!-- HEADER –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <div id="footer">
    <div class="container">
      <div class="row">
        <a class="col-md-2" href="#">Disclaimer</a>
        <a class="col-md-2" href="mailto:nowhere@mozilla.org">Contact</a>
        <a class="col-md-2" href="http://www.puppet.org/">CPA</a>
        <a class="col-md-2" href="https://www.gatech.edu">Georgia Tech</a>
        <a class="col-md-2" href="https://www.gatech.edu">Georgia Tech</a>
        <span class="col-md-2"></span>
        <a class="col-md-12" href="#">Some long text that spans multiple lines. Some long text that spans multiple lines Some long text that spans multiple lines</a>
      </div>
    </div>
  </div>
  <script src="./js/UnityLoader.js"></script>
  <script src="blob:http://localhost:8000/2315fd00-fac5-4952-b29a-9c5d31b2c5ba"></script>
  <script src="blob:http://localhost:8000/acdb315f-fec1-472a-a0e5-b9251e55a4c6"></script>
</body>
</html>
